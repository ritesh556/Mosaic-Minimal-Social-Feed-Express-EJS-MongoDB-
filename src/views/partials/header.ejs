<header class="bg-zinc-900/80 backdrop-blur border-b border-zinc-800 sticky top-0 z-40">
  <div class="max-w-6xl mx-auto px-3 sm:px-4 h-14 sm:h-16 flex items-center justify-between">
    <div class="flex items-center gap-3 min-w-0">
      <button type="button"
        class="group relative w-9 h-9 sm:w-10 sm:h-10 rounded-xl overflow-hidden bg-gradient-to-br from-blue-500 to-indigo-600 grid place-items-center font-bold shrink-0 js-open-avatar-modal"
        aria-label="Change avatar">
        <% if (user && user.avatarUrl) { %>
          <img src="<%= user.avatarUrl %>" alt="Avatar" class="w-full h-full object-cover" onerror="this.style.display='none'">
        <% } else { %>
          <span class="text-sm sm:text-base"><%= ((user && (user.username || user.email)) ? (user.username || user.email) : '?').trim().charAt(0).toUpperCase() %></span>
        <% } %>
        <span class="absolute inset-0 hidden group-hover:flex items-center justify-center bg-black/50 text-xs font-medium">Change</span>
      </button>

      <!-- ðŸ”” Notifications button -->
      <button id="notifBtn" class="relative px-3 py-1.5 rounded-lg bg-zinc-800 hover:bg-zinc-700 transition-colors">
        <span>ðŸ””</span>
        <span id="notif-badge"
              class="absolute -top-1.5 -right-1.5 min-w-[18px] h-[18px] px-1 rounded-full bg-pink-500 text-[10px] leading-[18px]
                     text-white text-center font-semibold shadow ring-1 ring-white/20 hidden">0</span>
      </button>

      <!-- ðŸ”” Notifications panel -->
      <div id="notifPanel" class="hidden absolute mt-12 left-3 w-[22rem] max-w-[90vw] bg-zinc-950 border border-zinc-800 rounded-xl shadow-xl">
        <div class="px-3 py-2 border-b border-zinc-800 flex items-center justify-between">
          <div class="font-semibold">Notifications</div>
          <form method="post" action="/notifications/read-all" onsubmit="return false;">
            <button id="notifReadAllBtn" class="text-xs text-zinc-400 hover:text-blue-300">Mark all as read</button>
          </form>
        </div>
        <div id="notifList" class="max-h-[60vh] overflow-y-auto divide-y divide-zinc-900">
          <div class="px-3 py-4 text-sm text-zinc-500">Loadingâ€¦</div>
        </div>
      </div>

      <div class="leading-tight min-w-0">
        <p class="text-sm sm:text-base font-semibold truncate" title="<%= user && user.email %>">
          Welcome, <span class="text-blue-400"><%= (user && (user.username || user.email)) || 'User' %></span>
        </p>
        <% if (user && user.role) { %>
          <span class="mt-0.5 inline-block align-middle px-2 py-0.5 text-[10px] sm:text-xs rounded-full bg-purple-600/20 text-purple-300 border border-purple-700">
            <%= String(user.role).toUpperCase() %>
          </span>
        <% } %>
      </div>
    </div>

    <!-- Right: nav -->
    <nav class="hidden md:flex items-center gap-2">
      <button onclick="openChatDrawer()" class="group relative inline-flex items-center gap-2 px-4 py-2 rounded-xl
               bg-gradient-to-br from-blue-600 to-indigo-600 text-white font-medium shadow-[0_8px_20px_rgba(37,99,235,.35)]
               hover:shadow-[0_10px_24px_rgba(37,99,235,.45)] hover:from-blue-500 hover:to-indigo-500
               active:scale-[.98] border border-white/10 outline-none focus-visible:ring-2 focus-visible:ring-blue-400/60 transition">
        <svg class="w-5 h-5 opacity-90 transition group-hover:opacity-100" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"
                d="M21 12c0 4.418-4.03 8-9 8-1.3 0-2.53-.235-3.64-.664L3 20l1.53-3.06C4.19 15.79 3 14.01 3 12 3 7.582 7.03 4 12 4s9 3.582 9 8Z"/>
        </svg>
        <span>Messages</span>
        <span id="unreadBadge"
              class="absolute -top-1.5 -right-1.5 min-w-[18px] h-[18px] px-1 rounded-full bg-pink-500 text-[10px] leading-[18px]
                     text-white text-center font-semibold shadow ring-1 ring-white/20 hidden">3</span>
      </button>

      <a href="/feed" class="px-3 py-2 rounded-lg bg-zinc-800 hover:bg-zinc-700 transition-colors">Feed</a>
      <a href="/logout" class="px-3 py-2 rounded-lg bg-red-600 hover:bg-red-700 transition-colors">Logout</a>
    </nav>

    <!-- Mobile menu button -->
    <button id="menuBtn" class="md:hidden p-2 rounded-lg bg-zinc-800 hover:bg-zinc-700" aria-label="Menu">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
    </button>
  </div>

  <!-- mobile dropdown container still lives in the page -->
</header>
